{
  "name": "Telegram Termin-Agent (Anonymisiert)",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Telegram Trigger').isExecuted ? $node[\"Telegram Trigger\"].json.message.text : ($('Transcribe a recording').isExecuted ? $node[\"Transcribe a recording\"].json.text : \"Guten Morgen! Bitte gib mir eine kurze Übersicht über alle meine Termine für den heutigen Tag.\") }}",
        "options": {
          "systemMessage": "=### ROLLE UND AUFGABE\nDu bist ein hochpräziser Kalender-Assistent. Deine Hauptaufgabe ist das Verwalten von Terminen.\n\n### DATUM-REFERENZ (WICHTIG FÜR BERECHNUNGEN)\n- Heute ist: {{ $now.setZone('Europe/Berlin').toFormat('EEEE, dd.MM.yyyy') }}\n- Aktuelle Uhrzeit: {{ $now.setZone('Europe/Berlin').toFormat('HH:mm') }} Uhr\n- Referenz-Zeitstempel (ISO): {{ $now.setZone('Europe/Berlin').toISO() }}\n\n... (Systemnachricht unverändert, sensible Daten entfernt) ..."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [32, -160],
      "id": "1e0723a8-66a3-450e-b506-f767ee79862e",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=ANONYMIZED_SESSION_KEY"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [-80, 64],
      "id": "d3774256-1b6d-436d-a577-30dce6b03835",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use this tool to search for existing calendar events. Provide 'timeMin' and 'timeMax' in ISO-8601 format.",
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "user@example.com",
          "mode": "list",
          "cachedResultName": "user@example.com"
        },
        "returnAll": true,
        "timeMin": "={{ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [32, 160],
      "id": "082d0d25-be52-456a-801c-75175b26e10d",
      "name": "Get many events in Google Calendar",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ANONYMIZED_ID_1",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "user@example.com",
          "mode": "list",
          "cachedResultName": "user@example.com"
        },
        "eventId": "={{ $fromAI('Event_ID', '', 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [176, 192],
      "id": "96a7912a-84e8-41d2-8a1d-6709098b6783",
      "name": "Delete event in Google Calendar",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ANONYMIZED_ID_1",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "calendar": {
          "__rl": true,
          "value": "user@example.com",
          "mode": "list",
          "cachedResultName": "user@example.com"
        },
        "eventId": "={{ $fromAI('Event_ID', '', 'string') }}",
        "updateFields": {
          "end": "={{ $fromAI('End', '', 'string') }}",
          "start": "={{ $fromAI('Start', '', 'string') }}",
          "summary": "="
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [320, 144],
      "id": "15890bbb-6601-46d3-a1ac-8894f11cbf96",
      "name": "Update event in Google Calendar",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ANONYMIZED_ID_1",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "ANONYMIZED_CHAT_ID",
        "text": "={{ $json.output.split('}').pop().trim() }}",
        "additionalFields": { "appendAttribution": false }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [592, -160],
      "id": "8c8857f7-a052-4f79-bebe-beb965e31968",
      "name": "Send a text message",
      "credentials": {
        "telegramApi": {
          "id": "ANONYMIZED_ID_2",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "model": { "__rl": true, "mode": "list", "value": "gpt-4.1-mini" },
        "builtInTools": {},
        "options": { "maxTokens": 1000, "temperature": 0 }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [-208, -16],
      "id": "81cd6745-fc0b-44c8-b316-5b604fa48eea",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "ANONYMIZED_ID_3",
          "name": "OpenAi Marco"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2.1,
      "position": [-176, -320],
      "id": "24a556d4-847a-47e1-8d5a-93fcc03988c0",
      "name": "Transcribe a recording",
      "credentials": {
        "openAiApi": {
          "id": "ANONYMIZED_ID_3",
          "name": "OpenAi Marco"
        }
      }
    }
  ],
  "connections": {},
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "ANONYMIZED_VERSION",
  "id": "ANONYMIZED_WORKFLOW_ID",
  "tags": [{ "name": "Chatbot" }, { "name": "KI-Agent" }]
}
